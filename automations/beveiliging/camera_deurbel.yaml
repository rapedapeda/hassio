- id: opname_deurbel
  alias: Opname (deurbel)
  trigger: 
    - platform: state
      entity_id:
        - binary_sensor.deurbel_button_pressed
        - binary_sensor.voordeur
      to: 'on'
  condition: []
  action:
    service: camera.record
    target:
      entity_id: camera.deurbel_main
    data:
      filename: '/share/Opnames/Deurbel/{{ now().strftime("%Y-%m-%d") }}/{{ now().strftime("%Y%m%d-%H%M%S") }}.mp4'
      duration: 15
      lookback: 5

- id: opname_voordeur
  alias: Opname (voordeur)
  trigger: 
    - platform: state
      entity_id:
        - binary_sensor.voordeur
      to: 'on'
  condition: 
    alias: "Alarm is armed"
    condition: not
    conditions:
    - condition: state
      entity_id: alarm_control_panel.huis
      state: "home"
  action:
    service: camera.record
    target:
      entity_id: camera.deurbel_main
    data:
      filename: '/share/Opnames/Deurbel/{{ now().strftime("%Y-%m-%d") }}/{{ now().strftime("%Y%m%d-%H%M%S") }}.mp4'
      duration: 15
      lookback: 5

- id: snapshot_deurbel
  alias: Snapshot (deurbel)
  trigger: 
    - platform: state
      entity_id:
        - binary_sensor.deurbel_button_pressed
        - binary_sensor.voordeur
      to: 'on'
  condition: []
  action:
    service: camera.snapshot
    target:
      entity_id: camera.deurbel_main
    data:
      filename: '/share/Snapshot/Deurbel/{{ now().strftime("%Y-%m-%d") }}/{{ now().strftime("%Y%m%d-%H%M%S") }}.mp4'

- id: snapshot_voordeur
  alias: Snapshot (voordeur)
  trigger: 
    - platform: state
      entity_id:
        - binary_sensor.voordeur
      to: 'on'
  condition: 
    alias: "Alarm is armed"
    condition: not
    conditions:
    - condition: state
      entity_id: alarm_control_panel.huis
      state: "home"
  action:
    service: camera.snapshot
    target:
      entity_id: camera.deurbel_main
    data:
      filename: '/share/Snapshot/Deurbel/{{ now().strftime("%Y-%m-%d") }}/{{ now().strftime("%Y%m%d-%H%M%S") }}.mp4'