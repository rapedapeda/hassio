# Boost ventilatie als luchtvochtigheid meer is dan 110% van het gemiddelde
- id: ventilatie_boost_luchtvochtigheid_badkamer
  alias: Ventilatie boost aan (luchtvochtigheid badkamer)
  mode: parallel
  trigger:
  - platform: event
    event_type: state_changed
  condition: 
  - condition: and
    conditions:
    - condition: template
      value_template: >
        {{
          trigger.event.data.entity_id.startswith('sensor.luchtvochtigheid_badkamer') 
        }}  
    - condition: template
      # Afwijking ten opzichte van gemiddelde waarde
      value_template: "{{ ( states('sensor.luchtvochtigheid_badkamer')|float - states('sensor.luchtvochtigheid_badkamer_statistics')|float ) / states('sensor.luchtvochtigheid_badkamer_statistics')|float > 0.15 }}"
    - alias: "Ventilatie moet op auto staan"
      condition: state
      entity_id: fan.wtw
      attribute: preset_mode
      state: "auto"
    - alias: "Ventilatie moet aan staan"
      condition: state
      entity_id: fan.wtw
      state: "on"
  action:
    service: fan.set_percentage
    target:
      entity_id: fan.wtw
    data:
      percentage: 66

- id: ventilatie_boost_luchtvochtigheid_badkamer_uit
  alias: Ventilatie boost uit (luchtvochtigheid badkamer)
  mode: parallel
  trigger:
  - platform: event
    event_type: state_changed
  condition: 
  - condition: and
    conditions:
    - condition: template
      value_template: >
        {{
          trigger.event.data.entity_id.startswith('sensor.luchtvochtigheid_badkamer') 
        }}  
    - condition: template
      # Afwijking ten opzichte van gemiddelde waarde
      value_template: "{{ ( states('sensor.luchtvochtigheid_badkamer')|float - states('sensor.luchtvochtigheid_badkamer_statistics')|float ) / states('sensor.luchtvochtigheid_badkamer_statistics')|float < 0.1 }}"
    - alias: "Ventilatie moet op auto staan"
      condition: state
      entity_id: fan.wtw
      attribute: preset_mode
      state: "auto"
    - alias: "Ventilatie moet aan staan"
      condition: state
      entity_id: fan.wtw
      state: "on"
  action:
    service: fan.set_percentage
    target:
      entity_id: fan.wtw
    data:
      percentage: 33