- id: media_player_shield_volume
  alias: MP Shield Volume
  trigger:
  - platform: state
    entity_id: media_player.nvidia_shield
  condition:
    condition: template
    value_template: >
      {{ trigger.from_state and
          trigger.to_state.attributes.source !=
          trigger.from_state.attributes.source }}
  action:
  - service: media_player.volume_set
    data_template:
      entity_id: media_player.nvidia_shield
      volume_level: >
        {% if is_state("input_boolean.bed_occupancy", "off") and (is_state_attr('media_player.nvidia_shield', 'source', 'Geforce NOW') or is_state_attr('media_player.nvidia_shield', 'source', 'RetroArch') or is_state_attr('media_player.nvidia_shield', 'source', 'Dolphin')) %}
          4
        {% elif is_state("input_boolean.bed_occupancy", "off") and (is_state_attr('media_player.nvidia_shield', 'source', 'NlZiet') or is_state_attr('media_player.nvidia_shield', 'source', 'Netflix') or is_state_attr('media_player.nvidia_shield', 'source', 'Amazon')) %}
          65
        {% elif is_state("input_boolean.bed_occupancy", "off") and (is_state_attr('media_player.nvidia_shield', 'source', 'Radio') or is_state_attr('media_player.nvidia_shield', 'source', 'Spotify') or is_state_attr('media_player.nvidia_shield', 'source', 'Tidal') or is_state_attr('media_player.nvidia_shield', 'source', 'Youtube')) %}
          35
        {% elif is_state("input_boolean.bed_occupancy", "on") %}
          15
        {% endif %}