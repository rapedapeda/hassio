- id: scene_aanwezigheid_uit
  alias: Scene aanwezigheid uit
  description: Automatisering die scene 'Uit' selecteerd als aanwezigheid naar 'Uit' gaat
  mode: parallel
  trigger:
      # Deze triggert als de timer van de ruimte finished is
    - platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.woonkamer
      # Deze triggert als daglicht weer voldoende aanwezig is
    - platform: state
      entity_id:
        - binary_sensor.woonkamer_lichtstatus
        - binary_sensor.slaapkamer_lichtstatus
      to: 'on'
  condition: []
    # - condition: template
    #   value_template: >-
    #     {% if 'lichtstatus' in trigger.entity_id %}
    #       {{ is_state('binary_sensor.' + trigger.entity_id.split('_')[1].split('.')[1] + '_uitschakeltimer', 'on') }}
    #     {% else %}
    #       {{ is_state('binary_sensor.' + trigger.entity_id.split('_')[2] + '_uitschakeltimer', 'on') }}
    #     {% endif %}
  action:
    - service: input_select.select_option
      data: 
        entity_id: >-
          {% if 'lichtstatus' in trigger.entity_id %}
            input_select.kamer_scenes_{{ trigger.entity_id.split('_')[1].split('.')[1] }}
          {% else %}
            input_select.kamer_scenes_{{ trigger.entity_id.split('.')[1] }}
          {% endif %}   
        option: Uit

# Deze is van toen licht schakelde op de bin_sen aanwezigheid per kamer (met delay_off)
# - id: scene_aanwezigheid_uit
#   alias: Scene aanwezigheid uit
#   description: Automatisering die scene 'Uit' selecteerd als aanwezigheid naar 'Uit' gaat
#   mode: parallel
#   trigger:
#       # Deze triggert als er niemand meer in de ruimte is
#     - platform: state
#       entity_id:
#         - binary_sensor.aanwezigheid_woonkamer
#         - binary_sensor.aanwezigheid_slaapkamer
#         - binary_sensor.aanwezigheid_hal
#         - binary_sensor.aanwezigheid_badkamer
#       to: 'off'
#       for: >
#           {{ states('input_number.kamers_aanwezigheid_' + trigger.entity_id.split('_')[2])|int|multiply(60)|timestamp_custom('%H:%M', false) }}
#       # Deze triggert als daglicht weer voldoende aanwezig is
#     - platform: state
#       entity_id:
#         - binary_sensor.woonkamer_lichtstatus
#         - binary_sensor.slaapkamer_lichtstatus
#       to: 'on'
#   condition: []
#     # - condition: template
#     #   value_template: >-
#     #     {% if 'lichtstatus' in trigger.entity_id %}
#     #       {{ is_state('binary_sensor.' + trigger.entity_id.split('_')[1].split('.')[1] + '_uitschakeltimer', 'on') }}
#     #     {% else %}
#     #       {{ is_state('binary_sensor.' + trigger.entity_id.split('_')[2] + '_uitschakeltimer', 'on') }}
#     #     {% endif %}
#   action:
#     - service: input_select.select_option
#       data: 
#         entity_id: >-
#           {% if 'lichtstatus' in trigger.entity_id %}
#             input_select.kamer_scenes_{{ trigger.entity_id.split('_')[1].split('.')[1] }}
#           {% else %}
#             input_select.kamer_scenes_{{ trigger.entity_id.split('_')[2] }}
#           {% endif %}   
#         option: Uit