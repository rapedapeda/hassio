stofzuig_zone:
  sequence:
  - service: script.turn_on
    target:
      entity_id: script.stofzuig_zone_message
    data:
      variables: # hier zit nog in dat ie een lijst aanlevert. Dat werkt niet bij zones met de V1 
        zones: '{{expand("group.schoonmaken") | selectattr("state","eq","on")
          | map(attribute="attributes.zone_id") | list | to_json}}'
  mode: single
  alias: Stofzuig zone
  icon: mdi:arrow-right

stofzuig_zone_message:
  alias: stofzuig_zone_message
  mode: single
  sequence:
  - service: mqtt.publish
    data:
      #payload_template: '{"segment_ids": {{segments}}}'
      topic: homeassistant/rockrobo/ZoneCleaningCapability/start/set
      payload_template: '{{zones}}'
  - delay: 00:01:00
  - wait_template: "{{ is_state('vacuum.stofzuiger', 'docked') }}"
  - service: script.stofzuiger_afvalbak_vullen